{"version":3,"file":"testcasetools.min.js","sources":["../src/testcasetools.js"],"sourcesContent":["define(['qtype_coderunnerex/localresmanager'], function({localResManager}) {\n\n    function getTargetElements(rootElem, {\n        displayCopyButtonForTestCaseInput, displayCopyButtonForTestCaseOutput,\n        displayCopyButtonForTestCaseCode, displayCopyButtonForTestCaseExpected,\n        displayCopyButtonForExampleTable\n    }) {\n        if (rootElem.querySelectorAll) {\n            let selectors = [];\n            if (displayCopyButtonForExampleTable)\n                selectors.push('.coderunnerexamples tbody td');\n\n            if (displayCopyButtonForTestCaseCode)\n                selectors.push('.coderunner-test-results tbody td.col_testcode');\n            if (displayCopyButtonForTestCaseInput)\n                selectors.push('.coderunner-test-results tbody td.col_stdin');\n            if (displayCopyButtonForTestCaseOutput)\n                selectors.push('.coderunner-test-results tbody td.col_got');\n            if (displayCopyButtonForTestCaseExpected)\n                selectors.push('.coderunner-test-results tbody td.col_expected');\n\n            const selector = selectors.join(', ');\n\n            if (selector)\n                return rootElem.querySelectorAll(selector);\n            else\n                return [];\n        }\n        else\n            return [];\n    }\n    function createCopyButton(parentElem, caption, hint)\n    {\n        if (!parentElem.__$sampleCopyBtn__)\n        {\n            var doc = parentElem.ownerDocument;\n            var btn = doc.createElement('button');\n            btn.className = 'CodeRunner-SampleCopyBtn';\n            btn.setAttribute('type', 'button');\n            btn.setAttribute('title', hint);\n            //btn.setAttribute('text', 'Copy');\n            btn.innerHTML = '<span>' + caption + '</span>';\n            btn.addEventListener('click', function(e) {\n                /*\n                if (navigator.clipboard)\n                {\n                    var codeElem = parentElem.getElementsByTagName('pre')[0];\n                    if (codeElem) {\n                        var text = codeElem.innerText;\n                        navigator.clipboard.writeText(text);\n                        console.log('copy text', text);\n                    }\n                }\n                */\n                var codeElem = parentElem.getElementsByTagName('pre')[0];\n                if (codeElem) {\n                    var text = codeElem.innerText;\n                    //navigator.clipboard.writeText(text);\n                    copyText(btn.ownerDocument, text, btn);\n                    //console.log('copy text', text);\n                }\n            });\n            parentElem.appendChild(btn);\n            parentElem.__$sampleCopyBtn__ = btn;\n            return btn;\n        }\n        else\n            return null;\n    }\n    function getClipboardTextHolder(doc)\n    {\n        if (doc.__$clipboardTextHolder$__)\n            return doc.__$clipboardTextHolder$__;\n        else\n        {\n            var elem = document.createElement('textarea');\n            elem.className = 'CodeRunner-SampleCopyTextHolder'\n            doc.body.appendChild(elem);\n            doc.__$clipboardTextHolder$__ = elem;\n            return elem;\n        }\n    }\n    function copyText(doc, text, invokerElem)\n    {\n        var textHolder = getClipboardTextHolder(doc);\n        // append to invoker parent, avoid page scrolling when focus to textholder\n        var parentElem = invokerElem.parentNode;\n        parentElem.appendChild(textHolder);\n        textHolder.value = text;\n        textHolder.focus();\n        textHolder.select();\n        doc.execCommand('copy');\n        //doc.body.appendChild(textHolder);\n        invokerElem.focus();\n    }\n\n    async function createTools({\n        displayCopyButtonForTestCaseInput, displayCopyButtonForTestCaseOutput,\n        displayCopyButtonForTestCaseCode, displayCopyButtonForTestCaseExpected,\n        displayCopyButtonForExampleTable\n    }) {\n        const localStrings = await localResManager.getLocalStrings([\n            'copy_to_clipboard_caption',\n            'copy_to_clipboard_hint'\n        ]);\n        const targetElems = getTargetElements(document.body, {\n            displayCopyButtonForTestCaseInput, displayCopyButtonForTestCaseOutput,\n            displayCopyButtonForTestCaseCode, displayCopyButtonForTestCaseExpected,\n            displayCopyButtonForExampleTable\n        });\n        if (targetElems)\n        {\n            for (var i = 0, l = targetElems.length; i < l; ++i)\n            {\n                createCopyButton(targetElems[i], localStrings['copy_to_clipboard_caption'], localStrings['copy_to_clipboard_hint']);\n            }\n        }\n    }\n\n    function init({\n          displayCopyButtonForTestCaseInput = true, displayCopyButtonForTestCaseOutput = true,\n          displayCopyButtonForTestCaseCode = true, displayCopyButtonForTestCaseExpected = true,\n          displayCopyButtonForExampleTable = true\n    }) {\n        const doInit = () =>\n            createTools({\n                displayCopyButtonForTestCaseInput, displayCopyButtonForTestCaseOutput,\n                displayCopyButtonForTestCaseCode, displayCopyButtonForTestCaseExpected,\n                displayCopyButtonForExampleTable\n            });\n\n        if (displayCopyButtonForTestCaseInput\n            || displayCopyButtonForTestCaseOutput\n            || displayCopyButtonForTestCaseCode\n            || displayCopyButtonForTestCaseExpected\n            || displayCopyButtonForExampleTable\n        ) {\n            // TODO: when encrypt data transfer, the testcase result table may be created by JS code after DOM loaded, need to handle this\n            if (document.readyState === \"loading\") {\n                doc.addEventListener('DOMContentLoaded', function (e) {\n                    doInit();\n                });\n            } else {\n                doInit();\n            }\n        }\n    }\n\n    return {\n        init\n    }\n});"],"names":["define","localResManager","createCopyButton","parentElem","caption","hint","__$sampleCopyBtn__","btn","ownerDocument","createElement","className","setAttribute","innerHTML","addEventListener","e","codeElem","getElementsByTagName","text","innerText","doc","invokerElem","textHolder","__$clipboardTextHolder$__","elem","document","body","appendChild","getClipboardTextHolder","parentNode","value","focus","select","execCommand","copyText","init","displayCopyButtonForTestCaseInput","displayCopyButtonForTestCaseOutput","displayCopyButtonForTestCaseCode","displayCopyButtonForTestCaseExpected","displayCopyButtonForExampleTable","doInit","localStrings","getLocalStrings","targetElems","rootElem","querySelectorAll","selectors","push","selector","join","getTargetElements","i","l","length","createTools","readyState"],"mappings":"AAAAA,0CAAO,CAAC,uCAAuC,mBAASC,gBAACA,+BA+B5CC,iBAAiBC,WAAYC,QAASC,SAEtCF,WAAWG,mBAkCZ,OAAO,SA/BHC,IADMJ,WAAWK,cACPC,cAAc,iBAC5BF,IAAIG,UAAY,2BAChBH,IAAII,aAAa,OAAQ,UACzBJ,IAAII,aAAa,QAASN,MAE1BE,IAAIK,UAAY,SAAWR,QAAU,UACrCG,IAAIM,iBAAiB,SAAS,SAASC,OAY/BC,SAAWZ,WAAWa,qBAAqB,OAAO,MAClDD,SAAU,KACNE,KAAOF,SAASG,oBA0BlBC,IAAKF,KAAMG,iBAErBC,oBAfwBF,QAExBA,IAAIG,0BACJ,OAAOH,IAAIG,8BAGPC,KAAOC,SAASf,cAAc,mBAClCc,KAAKb,UAAY,kCACjBS,IAAIM,KAAKC,YAAYH,MACrBJ,IAAIG,0BAA4BC,KACzBA,KAKMI,CAAuBR,KAEvBC,YAAYQ,WAClBF,YAAYL,YACvBA,WAAWQ,MAAQZ,KACnBI,WAAWS,QACXT,WAAWU,SACXZ,IAAIa,YAAY,QAEhBZ,YAAYU,QAnCAG,CAAS1B,IAAIC,cAAeS,KAAMV,SAI1CJ,WAAWuB,YAAYnB,KACvBJ,WAAWG,mBAAqBC,IACzBA,UAoFR,CACH2B,yBA9BUC,kCACRA,mCAAoC,EAD5BC,mCACkCA,oCAAqC,EADvEC,iCAERA,kCAAmC,EAF3BC,qCAEiCA,sCAAuC,EAFxEC,iCAGRA,kCAAmC,eAE/BC,OAAS,8BA5BQL,kCACvBA,kCADuBC,mCACYA,mCADZC,iCAEvBA,iCAFuBC,qCAEWA,qCAFXC,iCAGvBA,8CAEME,mBAAqBxC,gBAAgByC,gBAAgB,CACvD,4BACA,2BAEEC,qBAvGiBC,oBAAUT,kCACjCA,kCADiCC,mCACEA,mCADFC,iCAEjCA,iCAFiCC,qCAECA,qCAFDC,iCAGjCA,2CAEIK,SAASC,iBAAkB,KACvBC,UAAY,GACZP,kCACAO,UAAUC,KAAK,gCAEfV,kCACAS,UAAUC,KAAK,kDACfZ,mCACAW,UAAUC,KAAK,+CACfX,oCACAU,UAAUC,KAAK,6CACfT,sCACAQ,UAAUC,KAAK,wDAEbC,SAAWF,UAAUG,KAAK,aAE5BD,SACOJ,SAASC,iBAAiBG,UAE1B,GAGX,MAAO,GA4ESE,CAAkB1B,SAASC,KAAM,CACjDU,kCAAAA,kCAAmCC,mCAAAA,mCACnCC,iCAAAA,iCAAkCC,qCAAAA,qCAClCC,iCAAAA,sCAEAI,gBAEK,IAAIQ,EAAI,EAAGC,EAAIT,YAAYU,OAAQF,EAAIC,IAAKD,EAE7CjD,iBAAiByC,YAAYQ,GAAIV,aAAY,0BAA+BA,aAAY,wBAW5Fa,CAAY,CACRnB,kCAAAA,kCAAmCC,mCAAAA,mCACnCC,iCAAAA,iCAAkCC,qCAAAA,qCAClCC,iCAAAA,oCAGJJ,mCACGC,oCACAC,kCACAC,sCACAC,oCAGyB,YAAxBf,SAAS+B,WACTpC,IAAIN,iBAAiB,oBAAoB,SAAUC,GAC/C0B,YAGJA"}