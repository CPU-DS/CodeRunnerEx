define("qtype_coderunnerex/encrypttransfer",[],(function(){function encryptString(string){return btoa(String.fromCharCode(...(new TextEncoder).encode(string)))}function decryptString(string){return(new TextDecoder).decode(Uint8Array.from(atob(string),(c=>c.charCodeAt(0))))}function decryptPlaceHolderElem(doc,placeholder){const html=decryptString(placeholder.getAttribute("data-raw")),dummyElem=doc.createElement("div");dummyElem.innerHTML=html;const fragment=doc.createDocumentFragment();for(let i=0,l=dummyElem.children.length;i<l;++i)fragment.appendChild(dummyElem.children[i]);return placeholder.replaceWith(fragment),html}function decryptCodeEditor(doc,placeholder,codeEditorPlugin){const code=decryptString(placeholder.getAttribute("data-raw")),targetId=placeholder.getAttribute("data-target-id"),targetElem=doc.getElementById(targetId);targetElem&&(targetElem.innerHTML=code);const codeContent=targetElem.value;"none"===codeEditorPlugin||("scratchpad"===codeEditorPlugin?function(doc,targetId,content){if(!content)return;try{const obj=JSON.parse(content);if(window.ace){const codeEditorWrapperId=targetId+"_answer-code_wrapper",codeEditorWrapperElem=doc.getElementById(codeEditorWrapperId);if(codeEditorWrapperElem){const aceEditorElem=codeEditorWrapperElem.getElementsByClassName("ace_editor")[0];aceEditorElem&&_setAceEditorContent(aceEditorElem,obj.answer_code.join("\n"))}const testEditorWrapperId=targetId+"_test-code_wrapper",testEditorWrapperElem=doc.getElementById(testEditorWrapperId);if(testEditorWrapperElem){const aceEditorElem=testEditorWrapperElem.getElementsByClassName("ace_editor")[0];aceEditorElem&&_setAceEditorContent(aceEditorElem,obj.test_code.join("\n"))}}}catch(e){return void _fillCodeEditor_ace(doc,targetId,content)}}(doc,targetId,codeContent):_fillCodeEditor_ace(doc,targetId,codeContent)),placeholder.remove()}function _fillCodeEditor_ace(doc,targetId,content){if(window.ace){const richEditorWrapperId=targetId+"_wrapper",richEditorWrapperElem=doc.getElementById(richEditorWrapperId);if(richEditorWrapperElem){const aceEditorElem=richEditorWrapperElem.getElementsByClassName("ace_editor")[0];aceEditorElem&&_setAceEditorContent(aceEditorElem,content)}}}function _setAceEditorContent(elem,content){const aceEditor=ace.edit(elem);session=aceEditor.getSession(),session.setValue(content)}function initServerDataDecryptor(doc,questionRootElem){let targetParent=questionRootElem||doc.body;if(targetParent){const encryptedPlaceHolders=targetParent.querySelectorAll(".CodeRunnerEx-EncPlaceholder");for(let i=0,l=encryptedPlaceHolders.length;i<l;++i){const codeEditorPlugin=encryptedPlaceHolders[i].getAttribute("data-code-editor");codeEditorPlugin?decryptCodeEditor(doc,encryptedPlaceHolders[i],codeEditorPlugin):decryptPlaceHolderElem(doc,encryptedPlaceHolders[i])}}}function initClientDataEncryptor(doc,questionRootElem,questionResponseFieldElem){let targetForm=questionResponseFieldElem.form;targetForm&&questionResponseFieldElem&&!questionResponseFieldElem.__clientDataEncryptorPrepared__&&(!function(doc,form,responseFieldElem){const hiddenElem=doc.createElement("input");hiddenElem.type="hidden",hiddenElem.name=responseFieldElem.name+"_encrypted",hiddenElem.id=responseFieldElem.id+"_encrypted",responseFieldElem.name="",responseFieldElem.parentNode.insertBefore(hiddenElem,responseFieldElem)}(doc,0,questionResponseFieldElem),targetForm.addEventListener("submit",(function(e){!function(form){const elems=function(form){let result=[];const elems=form.getElementsByTagName("textarea");for(let i=0;i<elems.length;i++){let elem=elems[i];elem.id&&elem.id.match(/.+\_answer/)&&result.push(elem)}return result}(form);for(let i=0;i<elems.length;i++){let elem=elems[i],id=elem.id+"_encrypted",hiddenElem=document.getElementById(id);hiddenElem&&(hiddenElem.value=encryptString(elem.value),console.log("encrypted data",hiddenElem.value))}}(targetForm)})),questionResponseFieldElem.__clientDataEncryptorPrepared__=!0)}return{init:function(_ref){let{doc:doc,encryptServerDataTransfer:encryptServerDataTransfer,encryptClientDataTransfer:encryptClientDataTransfer,responseFieldId:responseFieldId}=_ref;doc||(doc=document);const doInit=doc=>{const questionResponseFieldElem=doc.getElementById(responseFieldId),questionRootElem=function(doc,questionResponseFieldElem){let currElem=questionResponseFieldElem;for(;currElem&&currElem!==doc.body&&!currElem.classList.contains("que");)currElem=currElem.parentNode;return currElem}(doc,questionResponseFieldElem);questionRootElem&&(encryptServerDataTransfer&&initServerDataDecryptor(doc,questionRootElem),encryptClientDataTransfer&&initClientDataEncryptor(doc,0,questionResponseFieldElem))};"loading"===document.readyState?doc.addEventListener("DOMContentLoaded",(function(e){doInit(doc)})):doInit(doc)}}}));

//# sourceMappingURL=encrypttransfer.min.js.map